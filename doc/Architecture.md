# Scobo-Engine Architecture

Scobo can be divided into four modules - three core modules and a UI modules, these modules have a mostly hierarchical relationship and thus we will look at them as layers.

The core modules are **Parse**, **Index**, **Query**, where the first two modules are separate as they are used in the initial setup of the engine in order to create the necessary data to later be searched, and the Query module is used to search the data and retrieve results. finally the **UI module** is used to facilitate user communication with the other layers.

![](diagrams/Abstract Layers.png)

## Parse Module

The Parse module receives the path to the corpus as input and is responsible for creating all document to termList maps that will later be used for indexing.

The Parse module is divided into two main parts, the first is the ReadFile submodule that is responsible for asynchronously taking multiple files from the corpus and splitting them up into documents these documents are then sent to the DocumentParse submodule that takes a document and finds all the terms appearing in it and creates `<document, termList>` mappings. (below is an abstract representation of the process)

![](diagrams/Parse Module.png)



## Index Module

The Index module receives the mappings created by the Parse module and  converts them into an inverted index mapping terms to a list of documents they appear in, this process is done in two phases:

* **Invert Phase**: first a batch of documents is taken from the parser and then is inverted into into term -> document mappings and then those mappings are written into a single posting file.
* **Merge Phase**: after all the documents have been inverted they are all merged into a single
   inverted file where each line is a term -> documents mapping

### Invert Phase

The invert phase starts once the parser is finished with the first document, the document is inserted into the document buffer, once the document buffer fills up it sends all of its documents to be inverted and then continues collecting new documents.

When a group of document arrives to be inverted, they are converted from `<document, termList>`mappings into `<term, documentList>` mappings and then are sent to be written into a new posting file. In the process of inverting the the documents a dictionary and a document map are created, 
the dictionary holds mappings from terms to their statistics and a pointer to the terms posting (is null at this stage), the document map holds mappings from document ids (generated by the mapper) to the documents data, such as document name, max term frequency and length.

The mappings are written to a file sorted alphabetically by the term string, such that each mapping is written in a new line with its document list. (below is an abstract representation of the process)

![invert phase](/home/shoham/Dev/Scobo-Engine/doc/diagrams/invert phase.png)

### Merge Phase

When all documents have been written into posting files, the indexer initiates a merge, during the merge all the posting files are read concurrently line by line. In each iteration we check to see which is the alphabetically minimal term in all the lines, then we merge all the lines containing said term and write the merged line into the inverted file, at this point the dictionary pointer is updated to point to the new line written to the inverted file.